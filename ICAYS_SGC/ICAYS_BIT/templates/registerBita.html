{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container-fluid">
    <form id="form-principal" method="post" enctype="multipart/form-data" >
        {% csrf_token %}
        <input type="hidden" id="usuario_id_actual" value="{{ request.user.id_user }}">
        <input type="hidden" id="estado_bitacora" name="estado_bitacora" value="guardada">
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <!-- Botón "Regresar" alineado a la izquierda -->
            <button class="icon-container button-style custom-button mb-2" type="button" data-url="{% url 'microalimentos:BitacorasAnaliticas' %}">Regresar</button>
            <div class="row mb-3 align-items-center">
                <!-- Selector de envío -->
                 <!-- En registerBita.html -->
                <div class="col-auto">
                    <div class="input-group">
                        <label class="input-group-text" for="usuario_destino">Enviar a:</label>
                        <select class="form-select" id="usuario_destino" name="usuario_destino" >
                            <option value="" selected>Seleccione un usuario...</option>
                        </select>
                    </div>
                </div>
                <!-- Botones alineados horizontalmente -->
                <div class="col-auto">
                    <button class="enviar-custom custom-button" type="button" data-bs-toggle="modal" data-bs-target="#enviar">Enviar</button>
                </div>
                <div class="col-auto">
                    <button class="cancelar-custom custom-button" data-url="{% url 'microalimentos:inicioAnalistas' %}" type="button">Cancelar</button>
                </div>
                <div class="col-auto">
                    <button class="guardar-custom custom-button" type="button"  onclick="guardarFormulario()">Guardar</button>
                </div>
            </div>
        </div>
        
        <div class="d-flex align-items-center p-3">
            <!-- Contenedor de botones alineado a la izquierda -->
            <div class="d-flex gap-3">
                <!-- Botón para ocultar/mostrar contenido -->
                <button class="btn btn-primary" id="toggleFormulario" type="button">
                    <i class="bi bi-arrow-down-circle"></i>
                </button>                
                <!-- Botón para agregar filas -->
                <button id="add-row-btn" class="btn btn-success" type="button">
                    <i class="bi bi-plus-circle"></i>
                </button>        
                <!-- Botón para eliminar filas -->
                <button id="remove-row-btn" class="btn btn-danger" type="button">
                    <i class="bi bi-dash-circle"></i>
                </button>
            </div>
        
            <!-- Título centrado -->
            <h1 class="text-center flex-grow-1 m-0" >Cuenta de bacterias aerobias en placa</h1>
            <input type="hidden" name="nombre_cbap" value="Cuenta de bacterias aerobias en placa" >
            <div class="d-flex gap-3">
                <div class="col-12 col-md-5">
                    <div class="form-floating">
                        <input type="text" class="form-control form-control-sm" id="pagina_cbap" name="pagina_cbap" value="" placeholder="Página" readonly>
                        <label for="pagina_cbap">Página</label>
                        <!-- Campo oculto para asegurar que el valor se envíe al formulario -->
                        <input type="hidden" id="pagina_cbap_hidden" name="pagina_cbap">
                    </div></qodoArtifact>
                </div>
            </div>
            
        </div>             
        
               
        <div id="contenidoOculto" class="oculto"> 
        <div class="container-fluid">
            <div class="container-fluid">
                <div class="card card-body">
                    <div class="row justify-content-center"> <!-- Centrar las tarjetas horizontalmente -->
                        <!-- Primera tarjeta -->
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 shadow-sm"> <!-- Añadí sombra y altura fija -->
                                <div class="card-body">
                                    <div class="row g-2"> <!-- Reducir el espacio entre filas -->
                                        <!-- Fecha, Hora, Procedimiento y Equipo de incubación -->
                                        <div class="col-12 col-md-6">
                                            <div class="form-floating">
                                                <input type="date" class="form-control form-control-sm" id="fecha_siembra" name="fecha_siembra" placeholder="Fecha" required>
                                                <label for="fecha_siembra">Fecha de siembra</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6 center">
                                            <div class="form-floating">
                                                <input type="time" class="form-control form-control-sm" id="hora_siembra" name="hora_siembra" placeholder="Hora" required>
                                                <label for="hora_siembra">Hora de siembra</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="form-floating">
                                                <input type="time" class="form-control form-control-sm" id="hora_incubacion" name="hora_incubacion" placeholder="Hora" required>
                                                <label for="hora_incubacion">Hora de incubación</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="form-floating">
                                                <input type="text" class="form-control form-control-sm" id="procedimiento" name="procedimiento" placeholder="LAI-04M2" value="LAI-04M2" readonly >
                                                <label for="procedimiento">Procedimiento</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="form-floating">
                                                <input type="text" class="form-control form-control-sm" id="equipo_incubacion" name="equipo_incubacion" placeholder="LAT-63 (35C°)" value="LAT-63 (35C°)" readonly>
                                                <label for="equipo_incubacion">Equipo de incubación</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Segunda tarjeta -->
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 shadow-sm"> <!-- Añadí sombra y altura fija -->
                                <div class="card-body">
                                    <!-- Título "Registro de muestras LAF-50" -->
                                    <div class="row mb-3">
                                        <div class="col-12 text-center">
                                            <h5 class="card-title">Registro de muestras LAF-50</h5> <!-- Usé h5 para el título -->
                                        </div>
                                    </div>
                
                                    <!-- Letra Analista, Tomo y Página -->
                                    <div class="row g-2">
                                        <div class="col-12 col-md-4">
                                            <div class="form-floating">
                                                <input type="text" class="form-control form-control-sm" id="letra_analista_cbap" name="letra_analista_cbap" placeholder="Letra Analista" required>
                                                <label for="letra_analista_cbap">Letra Analista</label>
                                            </div>
                                        </div>
                                        <!-- <div class="col-12 col-md-4">
                                            <div class="form-floating">
                                                <input type="date" class="form-control form-control-sm" id="mes_muestra_cbap" name="mes_muestra_cbap" placeholder="Tomo" >
                                                <label for="mes_muestra_cbap">Mes</label>
                                            </div>
                                        </div> -->
                                        <div class="col-12 col-md-4">
                                            <div class="form-floating">
                                                <input type="text" class="form-control form-control-sm" id="pagina_muestra_cbap" name="pagina_muestra_cbap" placeholder="Página" required>
                                                <label for="pagina_muestra_cbap">Página</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 shadow-sm"> <!-- Añadí sombra y altura fija -->
                                <div class="card-body">
                                    <div class="row g-2"> <!-- Reducir el espacio entre filas -->
                                        <h2 class="card-title">Fecha y hora de lecturas</h2>
                                        <!-- Fecha, Hora, Procedimiento y Equipo de incubación -->
                                        <div class="col-12 col-md-6">
                                            <div class="form-floating">
                                                <input type="date" class="form-control form-control-sm" id="fecha_lectura_cbap" name="fecha_lectura_cbap" placeholder="Fecha" required>
                                                <label for="fecha_lectura_cbap">Fecha de lectura</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6 center">
                                            <div class="form-floating">
                                                <input type="time" class="form-control form-control-sm" id="hora_lectura_cbap" name="hora_lectura_cbap" placeholder="Hora" required>
                                                <label for="hora_lectura_cbap">Hora de lectura</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="form-floating">
                                                <input type="date" class="form-control form-control-sm" id="floatingInput" placeholder="Fecha" >
                                                <label for="floatingInput">Fecha de lectura</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6 center">
                                            <div class="form-floating">
                                                <input type="time" class="form-control form-control-sm" id="floatingSiembra" placeholder="Hora">
                                                <label for="floatingInput">Hora de lectura</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Tercera tarjeta -->
                        <div class="col-md-8 mb-3">
                            <div class="card h-100 shadow-sm"> <!-- Añadí sombra y altura fija -->
                                <div class="card-body">
                                    <!-- Título "Reactivos y medios de cultivo LAF-02" -->
                                    <div class="row mb-3">
                                        <div class="col-12 text-center">
                                            <h5 class="card-title">Reactivos y medios de cultivo LAF-62</h5> <!-- Usé h5 para el título -->
                                        </div>
                                    </div>
                
                                    <!-- Solución reguladora de fosfato -->
                                    <div class="row g-2 mb-3">
                                        <div class="col-12 col-md-6">
                                            <div class="text-center">
                                                <h6 class="mb-0">Solución reguladora de fosfato</h6> <!-- Usé h6 para subtítulos -->
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-3">
                                            <div class="form-floating">
                                                <input type="text" name="pagina_fosfato_cbap" class="form-control form-control-sm" id="pagina_fosfato_cbap" placeholder="Página" >
                                                <label for="pagina_fosfato_cbap">Página</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-3">
                                            <div class="form-floating">
                                                <input type="text" name="numero_fosfato_cbap" class="form-control form-control-sm" id="numero_fosfato_cbap" placeholder="Número">
                                                <label for="numero_fosfato_cbap">Número</label>
                                            </div>
                                        </div>
                                    </div>
                
                                    <!-- Agar para métodos estándar -->
                                    <div class="row g-2">
                                        <div class="col-12 col-md-6">
                                            <div class="text-center">
                                                <h6 class="mb-0">Agar para métodos estándar</h6> <!-- Usé h6 para subtítulos -->
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-3">
                                            <div class="form-floating">
                                                <input type="text" name="pagina_agar_cbap" class="form-control form-control-sm" id="pagina_agar_cbap" placeholder="Página" >
                                                <label for="pagina_agar_cbap">Página</label>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-3">
                                            <div class="form-floating">
                                                <input type="text" name="numero_agar_cbap" class="form-control form-control-sm" id="numero_agar_cbap" placeholder="Número">
                                                <label for="numero_agar_cbap">Número</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>                    
                    </div>
           
            <!-- Tabla 2: Verificacion de balanza-->
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-md-12">
                                <div class="card shadow-sm"> <!-- Card con sombra -->
                                    <div class="card-body">
                                        <!-- Título de la card -->
                                        <h5 style="caption-side: top; text-align: center; font-size: 1.5em; font-weight: bold; padding: 10px; background-color: #063970; color: white; border-radius: 10px;">
                                            Verificación de la balanza granataria LAM-12  
                                        </h5>
                                        <div class="d-flex justify-content-center align-items-center w-100">
                                            <div class="d-flex align-items-center flex-wrap justify-content-center">
                                                <span class="mx-2">Ver verificación mensual de la balanza en: <a href="">LAF-42</a></span>
                                                <div class="d-flex align-items-center mx-2">
                                                    <span class="mx-2">Tomo</span>
                                                    <input type="text" class="form-control form-control-sm mx-2" style="width: 80px;" name="tomo_verficacion_vb">
                                                    <span class="mx-2">página</span>
                                                    <input type="text" class="form-control form-control-sm mx-2" style="width: 80px;" name="pagina_verficacion_vb">
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Tabla con labels fuera de los campos -->
                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Hora</th>
                                                        <th>Actividad</th>
                                                        <th>Ajuste de balanza</th>
                                                        <th>Valor nominal</th>
                                                        <th>Valor convencional</th>
                                                        <th>Valor obtenido de la masa</th>
                                                        <th>Diferencia absoluta</th>
                                                        <th>Incertidumbre aceptada</th>
                                                        <th>EMT</th>
                                                        <th>Criterio de aceptación</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Fila 1 -->
                                                    <tr>
                                                        <td>
                                                            <input type="time" name="hora_vb_1" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <div class="form-floating">
                                     
                                                                <input type="text" name="actividad_vb_1" value="Verificación" class="form-control form-control-sm" readonly>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <input type="text" name="ajuste_vb_1" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="valor_nominal_vb_1" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="valor_convencional_vb_1" id="valorConvencional" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="valo_masa_vb_1" id="valorObtenido" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="diferecnia_vb_1" id="diferenciaAbsoluta" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="incertidumbre_vb_1" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="emt_vb_1" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="aceptacion_vb_1" class="form-control form-control-sm">
                                                        </td>
                                                    </tr>
                                                    <!-- Fila 2 -->
                                                    <tr>
                                                        <td>
                                                            <input type="time" name="hora_vb_2" class="form-control form-control-sm">
                                                        </td>
                                                        <td>
                                                            <div class="input-group">
                                                                <textarea name="actividad_vb_2" class="form-control form-control-sm" readonly 
          style="height: auto; text-align: center; font-size: 12px; resize: none; border: none; overflow: hidden; white-space: pre-wrap; word-wrap: break-word;">
                                                                    Pesado de la(S) muestra(a)
                                                                    </textarea>
            
                                                            </div>
                                                        </td>
                                                        <td colspan="8">
                                                            <input type="text" name="valor_pesado_muestra_vb_2" class="form-control form-control-sm">
                                                        </td>
                                                    </tr>
                                                </tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                                    <!-- Tabla 2: Cumplimientos de calidad -->
                    <div class="row mb-4">
                        <div class="col-12 text-center">
                            <div class="table-responsive"> <!-- Contenedor responsivo para la tabla -->

                                <div class="container">
                                    <div class="row justify-content-center">
                                        <div class="col-md-12">
                                            <div class="card shadow-sm"> <!-- Card con sombra -->
                                                <div class="card-body">
                                                    <!-- Título de la card -->
                                                    <h5 style="caption-side: top; text-align: center; font-size: 1.5em; font-weight: bold; padding: 10px; background-color: #063970; color: white; border-radius: 10px;" >
                                                        Ver cumplimiento de controles de calidad en:
                                                    </h5>
                                
                                                    <!-- Primera fila de inputs -->
                                                    
                                                    <!-- Primera fila de inputs con etiquetas flotantes -->
                                                    <div class="row g-3 mb-3">
                                                        <!-- Bitácora/Tomo 1 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <div class="input-group input-group-sm">
                                                                    <div class="form-floating">
                                                                        <input type="text" class="form-control" id="nombre_laf_1" name="nombre_laf_1" value="LAF-45/" readonly>
                                                                      
                                                                    </div>
                                                                    <div class="form-floating">
                                                                        <input type="date" class="form-control" id="fecha_1cc_1" name="fecha_1cc_1" required >
                                                                        <label for="fecha_1cc_1">Fecha</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Página 1 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <input type="text" id="page_1cc_1" name="page_1cc_1" class="form-control" required >
                                                                <label for="page_1cc_1">Página</label>
                                                            </div>
                                                        </div>
                                                        <!-- Bitácora/Tomo 2 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <div class="input-group input-group-sm">
                                                                    <div class="form-floating">
                                                                        <input type="text" class="form-control" id="nombre_laf_2" name="nombre_laf_2" value="LAF-44/" readonly >
                                                                     
                                                                    </div>
                                                                    <div class="form-floating">
                                                                        <input type="date" class="form-control" id="fecha_1cc_2" name="fecha_1cc_2" required>
                                                                        <label for="fecha_1cc_2">Fecha</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Página 2 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <input type="text" id="page_1cc_2" name="page_1cc_2" class="form-control" required>
                                                                <label for="page_1cc_2">Página</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Segunda fila de inputs con etiquetas flotantes -->
                                                    <div class="row g-3 mb-3">
                                                        <!-- Bitácora/Tomo 3 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <div class="input-group input-group-sm">
                                                                    <div class="form-floating">
                                                                        <input type="text" class="form-control" id="nombre_laf_3" name="nombre_laf_3" value="LAF-57/" readonly>
                                                                    
                                                                    </div>
                                                                    <div class="form-floating">
                                                                        <input type="date" class="form-control" id="fecha_1cc_3" name="fecha_1cc_3" required>
                                                                        <label for="fecha_1cc_3">Fecha</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Página 3 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <input type="text" id="page_1cc_3" name="page_1cc_3" class="form-control" >
                                                                <label for="page_1cc_3">Página</label>
                                                            </div>
                                                        </div>
                                                        <!-- Bitácora/Tomo 4 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <div class="input-group input-group-sm">
                                                                    <div class="form-floating">
                                                                        <input type="text" class="form-control" id="nombre_laf_4" name="nombre_laf_4" value="LAF-52/" readonly>
                                                                       
                                                                    </div>
                                                                    <div class="form-floating">
                                                                        <input type="date" class="form-control" id="fecha_1cc_4" name="fecha_1cc_4" required>
                                                                        <label for="fecha_1cc_4">Fecha</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Página 4 -->
                                                        <div class="col-12 col-md-6 col-lg-3">
                                                            <div class="form-floating">
                                                                <input type="text" id="page_1cc_4" name="page_1cc_4" class="form-control" required>
                                                                <label for="page_1cc_4">Página</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                
                                                    <!-- Descripción de las bitácoras -->
                                                    <div class="row mt-4">
                                                        <div class="col-12 text-center">
                                                            <p class="mb-0 small">
                                                                <strong>LAF-45:</strong> Bitácora de control de calidad de microbiología,
                                                                <strong>LAF-44:</strong> Bitácora de control de medio ambiente,
                                                                <strong>LAF-57:</strong> Bitácora de bacterias aerobias en placa,
                                                                <strong>LAF-52:</strong> Bitácora de mohos y levaduras
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                 
            </div>
        </div>
    </div>
    </div>
           
        <div class="table-container">
            <!-- Agregar este input hidden justo antes o después de la tabla -->
            <table class="micro-table">
                <caption style="caption-side: top; text-align: center; font-size: 1.5em; font-weight: bold; padding: 10px; background-color: #063970; color: white;">
                    Tabla de Resultados
                </caption>
                <thead>
                    <tr>
                        <th rowspan="2">Clave Muestra</th>
                        <th rowspan="2">Matriz</th>
                        <th rowspan="2">Cantidad de muestra</th>
                        <th colspan="4">Diluciones empleadas</th>
                        <th colspan="2">Dilución o Directa</th>
                        <th rowspan="2">Promedio</th> <!-- Columna 4: Promedio -->
                        <th colspan="2">Dilución</th> <!-- Columnas 5 y 6 -->
                        <th rowspan="2">Promedio</th> <!-- Columna 7: Promedio entre Diluciones -->
                        <th colspan="2">Dilución</th> <!-- Columnas 8 y 9 -->
                        <th rowspan="2">Promedio</th> <!-- Columna 10: Promedio después de la segunda Dilución -->
                        <th colspan="2" >Resultado</th> <!-- Columna 11: Subcolumnas sin título -->
                        <th rowspan="2">Diferencia entre duplicados <5% </th>
                    </tr>
                    <tr>
                        <!-- Subencabezados para diluciones empleadas -->
                        <th>1</th>
                        <th>0.1</th>
                        <th>0.01</th>
                        <th>0.001</th>
                        <!-- Subencabezados para Dilución o Directa -->
                        <th>Placa 1</th>
                        <th>Placa 2</th>
                        <!-- Subencabezados para Dilución (columnas 5 y 6) -->
                        <th>Placa 1</th>
                        <th>Placa 2</th>
                        <!-- Subencabezados para Dilución (columnas 8 y 9) -->
                        <th>Placa 1</th>
                        <th>Placa 2</th>
                        <th>----</th>
                        <th>----</th>
                    </tr>
                </thead>
                <tbody id="tabla-body">
                    <!-- Fila adicional debajo de los títulos -->
                    <tr>
                        <td><input type="text" value="Blanco" style="width: 110px;" readonly></td> <!-- No editable -->
                        <td style="background:#c3ccd6;"><input type="text" name="cantidad_blanco[]" value="---" style="width: 110px;" readonly></td>
                        <td ><input type="text" id="cantidad_blanco" name="cantidad_blanco" ></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil1_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil2_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil3_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil4_blanco[]" value="---" readonly></td>
                        <td ><input type="text"  id="placa_blanco" name="placa_blanco" ></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dir_placa2_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="promedio1_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil_placa1_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil_placa2_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="promedio2_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil_placa1_dup_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="dil_placa2_dup_blanco[]" value="---" readonly></td>
                        <td style="background:#c3ccd6;"><input type="text" name="promedio3_blanco[]" value="---" readonly></td>
                        <!-- Subcolumnas de "Resultado" -->
                        <td><input type="text"  id="resultado_blanco" name="resultado_blanco"></td> <!-- Editable -->
                        <td style="background:#c3ccd6;"><input type="text" value="UFC/placa" style="width: 150px;" readonly></td> <!-- No editable en "Blanco" -->
                        <td style="background:#c3ccd6;"><input type="text" style="width: 100px;" name="diferencia_blanco[]" value="---" readonly></td>
                    </tr>
                    <!-- Fila principal de inputs -->
                    <tr>
                        

                    <!-- Se pueden agregar más filas de inputs si es necesario -->
                </tbody>
            </table>
        </div>  
        <div>
           <strong><p style="font-size: 15px; color: black;">** Valor estimado/ se reporta como UFC/cantidad de alimento o ml de agua o superficie analizada</p></strong> 
        </div>
        

        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <!-- Responsive table wrapper - visible only on medium screens and up -->
                    <div class="table-responsive d-none d-md-block">
                        <table class="table table-bordered text-center">
                            <thead class="thead-light">
                                <tr>
                                    <th class="w-20">Observaciones</th>
                                    <th>Ejemplo de calculo de resultado</th>
                                    <th>Ejemplo de calculo de resultado de superficies vivas e inertes</th>
                                    <th>Ejemplo de calculo diferencia entre duplicados</th>
                                    <th class="w-8">Elabora</th>
                                    <th class="w-8">Revisa</th>
                                    <th class="w-8">Autoriza</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="form-group">
                                            <textarea name="observaciones_cbap" class="form-control" rows="3" style="resize: none;" placeholder="Escriba sus observaciones aquí..."></textarea>
                                        </div>
                                    </td>
                                    
                                    <!-- Primera fórmula -->
<!-- Primera fórmula -->
<td class="align-middle">
    <!-- Content for calculo de resultado -->
    <div class="d-flex flex-column gap-1">
        <p class="fs-9 mb-0">Promedio de lectura ÷ Dilución empleada = Resultado</p>
        <div class="d-flex gap-1">
            <input type="number" id="num1" name="dato1_ejemplo_1" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            <span class="fs-9">÷</span>
            <input type="number" id="num2" name="dato2_ejemplo_1" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            <span class="fs-9">=</span>
            <!-- Resultado visible como label -->
            <label class="fs-9" id="result" >R</label>
            <!-- Input oculto para enviar el valor -->
            <input type="hidden" id="resultdo_ejemplo_1" name="resultdo_ejemplo_1">
        </div>
        <div class="d-flex gap-1 p-1">
            <p class="fs-9 mb-0">Clave muestra:</p>
            <input type="text" name="clave_muestra_ejemplo_1" class="form-control form-control-sm" style="width: 80px; height: 25px; font-size: 0.75rem;">
        </div>
    </div>
</td>
                                    
<!-- Segunda fórmula -->
<td class="align-middle">
    <!-- Content for calculo de resultado -->
    <div class="d-flex flex-column gap-1">
        <p class="fs-9 mb-0">Ejemplo de cálculo de resultado de superficies vivas e inertes:</p>
        <p class="fs-9 mb-0">(promedio de la lectura ÷ Dilución empleadas) x Volumen de medio de transporte = resultado</p>
        <div class="d-flex gap-1">
            (<input type="text" id="num3" name="dato1_ejemplo_2" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            <span class="fs-9">÷</span>
            <input type="text" id="num4" name="dato2_ejemplo_2" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">) x
            <input type="text" id="num5" name="dato3_ejemplo_2" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            <span class="fs-9">=</span>
            <!-- Resultado visible como label -->
            <label class="fs-9" id="result2" >R</label>
            <!-- Input oculto para enviar el valor -->
            <input type="hidden" id="resultdo_ejemplo_2" name="resultdo_ejemplo_2">
        </div>
        <div class="d-flex gap-1 p-1">
            <p class="fs-9 mb-0">Clave muestra:</p>
            <input type="text" name="clave_muestra_ejemplo_2" class="form-control form-control-sm" style="width: 80px; height: 25px; font-size: 0.75rem;">
        </div>
    </div>
</td>
                                    
<!-- Tercera fórmula -->
<td class="align-middle">
    <!-- Content for calculo de resultado -->
    <div class="d-flex flex-column gap-1">
        <p class="fs-9 mb-0">Ejemplo de cálculo diferencia entre duplicados</p>
        <div class="formula-container">
            <p class="formula-text flex-column mb-0">
                <span class="formula-part">(placa1 - placa2) ÷ Promedio × 100 = ≤5%</span>
            </p>
        </div>
        
        <div class="d-flex gap-1">
            <input type="text" id="num6" name="dato1_ejemplo_3" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            <span class="fs-9">-</span>
            <input type="text" id="num7" name="dato2_ejemplo_3" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            <span class="fs-9">÷</span>
            <input type="text" id="num8" name="dato3_ejemplo_3" class="form-control form-control-sm" style="width: 50px; height: 25px; font-size: 0.75rem;">
            
            <span class="fs-9">x 100 =</span>
            <!-- Resultado visible como label -->
            <label class="fs-9" id="result3" >R</label>
            <!-- Input oculto para enviar el valor -->
            <input type="hidden" id="resultdo_ejemplo_3" name="resultdo_ejemplo_3">
        </div>
        <div class="d-flex gap-1 p-1">
            <p class="fs-9 mb-0">Clave muestra:</p>
            <input type="text" name="clave_muestra_ejemplo_3" class="form-control form-control-sm" style="width: 80px; height: 25px; font-size: 0.75rem;">
        </div>
    </div>
</td>                             
                                    <td class="align-middle">
                                        <div class="text-center">
                                            <span class="text-muted">Pendiente de elaboración</span>
                                            <hr class="my-2">
                                            <span>Firma</span>
                                        </div>
                                    </td>
                                    
                                    <td class="align-middle">
                                        <div class="text-center">
                                            <span class="text-muted">Pendiente de revisión</span>
                                            <hr class="my-2">
                                            <span>Firma</span>
                                        </div>
                                    </td>
                                    
                                    <td class="align-middle">
                                        <div class="text-center">
                                            <span class="text-muted">Pendiente de autorización</span>
                                            <hr class="my-2">
                                            <span>Firma</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile-only accordion view that appears on small screens -->
                    <div class="d-md-none mt-3">
                        <div class="accordion" id="tableAccordion">
                            <!-- Observaciones Section -->
                            <div class="card">
                                <div class="card-header" id="headingObservaciones">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseObservaciones" aria-expanded="true" aria-controls="collapseObservaciones">
                                            Observaciones
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseObservaciones" class="collapse show" aria-labelledby="headingObservaciones" data-parent="#tableAccordion">
                                    <div class="card-body">
                                        <textarea name="observaciones_cbap_mobile" class="form-control" rows="3" style="resize: none;" placeholder="Escriba sus observaciones aquí..."></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cálculos Section -->
                            <div class="card">
                                <div class="card-header" id="headingCalculos">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseCalculos" aria-expanded="false" aria-controls="collapseCalculos">
                                            Cálculos
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseCalculos" class="collapse" aria-labelledby="headingCalculos" data-parent="#tableAccordion">
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <h6>Cálculo de resultado</h6>
                                            <small>Contenido del cálculo de resultado</small>
                                        </div>
                                        <div class="mb-3">
                                            <h6>Cálculo de superficies</h6>
                                            <small>Contenido del cálculo de superficies</small>
                                        </div>
                                        <div>
                                            <h6>Cálculo de diferencias</h6>
                                            <small>Contenido del cálculo de diferencias</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Firmas Section -->
                            <div class="card">
                                <div class="card-header" id="headingFirmas">
                                    <h2 class="mb-0">
                                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseFirmas" aria-expanded="false" aria-controls="collapseFirmas">
                                            Firmas
                                        </button>
                                    </h2>
                                </div>
                                <div id="collapseFirmas" class="collapse" aria-labelledby="headingFirmas" data-parent="#tableAccordion">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-4 text-center">
                                                <small class="text-muted">Elabora</small>
                                                <hr class="my-1">
                                                <small>Firma</small>
                                            </div>
                                            <div class="col-4 text-center">
                                                <small class="text-muted">Revisa</small>
                                                <hr class="my-1">
                                                <small>Firma</small>
                                            </div>
                                            <div class="col-4 text-center">
                                                <small class="text-muted">Autoriza</small>
                                                <hr class="my-1">
                                                <small>Firma</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
                <!-- Modal confirmación-->
        <div class="modal fade" id="enviar" tabindex="-1" aria-labelledby="enviar" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header justify-content-center">
                <h5 class="modal-title" id="enviar" >Enviar</h5>
                <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-muted text-center">
                    Porfavor antes de enviar asegurese que todo este correcto.
                </div>
                <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-danger me-2" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="abrirModalFirma()">Aceptar</button>
                </div>
            </div>
            </div>
        </div>
        <!-- Modal para firmar -->
        <div class="modal fade" id="firmar" tabindex="-1" aria-labelledby="firmar" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header justify-content-center">
                        <h5 class="modal-title text-danger" id="firmar">Firma del usuario</h5>
                        <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-danger" id="error-message" style="display: none;"></div>
                        <div class="form-group">
                            <label for="password" class="form-label">Ingrese su contraseña para firmar:</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-primary" onclick="enviarFormulario()">Firmar</button>
                    </div>
                </div>
            </div>
            </div>

        <!-- Modal para mensajes de éxito -->
        <div class="modal fade" id="mensajeExito" tabindex="-1" aria-labelledby="mensajeExitoLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="mensajeExitoLabel">
                            <i class="bi bi-check-circle me-2"></i>
                            Éxito
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    {% if messages %}
                            <div class="messages">
                                {% for message in messages %}
                                    {% if message.tags == 'error' %}
                                        <div class="alert alert-danger">
                                            {{ message }}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    <div class="modal-body text-center">
                        <p id="mensajeExitoTexto" class="mb-0"></p>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">Aceptar</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal para mensajes de exito guardado -->
       <!-- Modal para mensajes de éxito guardado -->
<div class="modal fade" id="guardarexito" tabindex="-1" aria-labelledby="mensajeExitoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="mensajeExitoLabel">
                    <i class="bi bi-check-circle me-2"></i>
                    Guardado
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <!-- Mensaje de éxito -->
                <p id="mensajeExitoTextoGuardar" class="mb-0"></p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal de Error -->
<div class="modal fade" id="modalError" tabindex="-1" aria-labelledby="mensajeExitoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="mensajeExitoLabel">
                    <i class="bi bi-check-circle me-2"></i>
                    Error al guardar bitacora
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <!-- Mensaje de éxito -->
                <p id="mensajeErrorTexto" class="mb-0"></p>
                <!-- Mensaje de error -->
                <div class="alert alert-danger mt-3" id="error-guardar" style="display: none;"></div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

    </form>

</div>
{% endblock %}
{% block extra_js %}
    <script type="module" src="{% static 'js/events-bita131.js' %}"></script>
    <script src="{% static 'js/functions.js' %}"></script>
    <script src="{% static 'js/form-validation.js' %}"></script>
{% endblock %}
